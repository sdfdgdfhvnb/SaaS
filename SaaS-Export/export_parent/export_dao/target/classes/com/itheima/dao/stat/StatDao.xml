<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.itheima.dao.stat.StatDao">

    <!--生产厂家销售统计-->
    <select id="factorySale" resultType="map">
        SELECT p.factory_name `name`,SUM(p.money) `value` FROM (
            SELECT
              factory_name,
              SUM(amount) money
            FROM co_contract_product
            WHERE factory_name IS NOT NULL
            GROUP BY factory_name

            UNION ALL

            SELECT
              factory_name ,
              SUM(amount) money
            FROM co_ext_cproduct
            WHERE factory_name IS NOT NULL
            GROUP BY factory_name
        ) p GROUP BY p.factory_name
    </select>

    <!--商品销售统计排行-->
    <select id="productSale" resultType="map">
        SELECT
            PRODUCT_NO `name`,
            SUM(amount) `value`
        FROM
            co_contract_product
        WHERE
            PRODUCT_NO !='' AND PRODUCT_NO IS NOT NULL
        GROUP BY PRODUCT_NO
        ORDER BY SUM(amount) DESC
        LIMIT #{top}
    </select>

    <!--系统访问压力图-->
    <select id="online" resultType="map">
        SELECT a.a1 `name`,IFNULL(p.value,0) `value` FROM st_online_info a
        LEFT JOIN(
        SELECT DATE_FORMAT(TIME,'%H') HOUR,COUNT(TIME) VALUE FROM st_sys_log
        GROUP BY DATE_FORMAT(TIME,'%H')
        )p ON a.a1=p.hour
    </select>

</mapper>